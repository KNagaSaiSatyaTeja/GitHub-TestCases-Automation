name: Run Code Tests

on:
  push:
    paths:
      - "solutions/**"
  pull_request:
    paths:
      - "tests/**"

jobs:
  run-tests:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0  # Fetch full history for git diff

      - name: Install Dependencies
        run: |
          sudo apt update
          sudo apt install -y gcc g++ openjdk-17-jdk python3

      - name: Detect Changed Files
        id: filter
        uses: dorny/paths-filter@v2
        with:
          filters: |
            c:
              - 'solutions/**/*.c'
            cpp:
              - 'solutions/**/*.cpp'
            python:
              - 'solutions/**/*.py'
            java:
              - 'solutions/**/*.java'

      - name: Compile and Run C Program
        if: steps.filter.outputs.c == 'true'
        run: |
          gcc solutions/main.c -o solution_c
          ./solution_c < tests/test.c

      - name: Compile and Run C++ Program
        if: steps.filter.outputs.cpp == 'true'
        run: |
          g++ solutions/main.cpp -o solution_cpp
          ./solution_cpp < tests/test.cpp

      - name: Run Python Program
        if: steps.filter.outputs.python == 'true'
        run: |
          python3 solutions/main.py < tests/test.py

      - name: Compile and Run Java Program
        if: steps.filter.outputs.java == 'true'
        run: |
          javac solutions/Main.java
          java -cp solutions Main < tests/MainTest.java
